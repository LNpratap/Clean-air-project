<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Air Project - Videos</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f4f8; margin:0; }
  header { background:#0056b3; color:#fff; padding:12px 20px; display:flex; justify-content:space-between; align-items:center; }
  header .brand { font-size:20px; font-weight:bold; }
  .btn { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
  .btn.login { background:#28a745; color:#fff; }
  .container { max-width:1000px; margin:20px auto; padding:0 15px; }
  #adminPanel { display:none; background:#fff; padding:15px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.15); margin-bottom:20px; }
  #videosContainer { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:18px; }
  .video-card { background:#fff; border-radius:10px; padding:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  .video-card iframe { width:100%; height:200px; border:0; border-radius:6px; }
  .video-card .title { font-weight:bold; margin:8px 0; }
  .delete-btn { background:#d63939; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; margin-top:5px; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
</head>
<body>

<header>
  <div class="brand">üå¨Ô∏è Clean Air Project ‚Äî Videos</div>
  <button class="btn login" id="loginBtn">Admin Login</button>
</header>

<div class="container">
  <div id="adminPanel">
    <h2>Upload Video</h2>
    <input type="text" id="videoTitle" placeholder="Video Title" style="width:100%; margin-bottom:10px; padding:6px;">
    <input type="text" id="youtubeURL" placeholder="Paste YouTube link (Creative Commons)" style="width:100%; padding:6px; margin-bottom:10px;">
    <button class="btn login" id="uploadBtn">Add Video</button>
  </div>

  <h2>Video Library</h2>
  <div id="videosContainer"></div>
</div>

<script>
// ----------- FIREBASE CONFIG -----------
const firebaseConfig = {
  apiKey: "AIzaSyDuZTgTY5AeOyd-5n7sGgM2hf1Qw2NJL-A",
  authDomain: "clean-air-project-allenps.firebaseapp.com",
  projectId: "clean-air-project-allenps"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ----------- ADMIN LOGIN -----------
const ADMIN_EMAIL = "admin@gmail.com";
const ADMIN_PASS = "123456";
let isAdmin = false;
const loginBtn = document.getElementById("loginBtn");
const adminPanel = document.getElementById("adminPanel");

loginBtn.addEventListener("click", () => {
  const email = prompt("Admin email:");
  const pass = prompt("Password:");
  if(email === ADMIN_EMAIL && pass === ADMIN_PASS){
    isAdmin = true;
    adminPanel.style.display = "block";
    loginBtn.style.display = "none";
    loadVideos();
  } else alert("Incorrect login.");
});

// ----------- CONVERT YOUTUBE LINK TO EMBED -----------
function convertToEmbed(url){
  url = url.trim();
  url = url.replace("m.youtube.com","www.youtube.com");
  url = url.replace("youtube.com/shorts/","youtube.com/watch?v=");
  if(url.includes("youtu.be/")){
    const id = url.split("youtu.be/")[1].split("?")[0];
    return "https://www.youtube.com/embed/" + id;
  }
  if(url.includes("watch?v=")){
    const id = url.split("watch?v=")[1].split("&")[0];
    return "https://www.youtube.com/embed/" + id;
  }
  return url;
}

// ----------- ADD VIDEO -----------
document.getElementById("uploadBtn").addEventListener("click", async ()=>{
  const title = document.getElementById("videoTitle").value.trim();
  const yt = document.getElementById("youtubeURL").value.trim();
  if(!title || !yt) return alert("Enter title and YouTube link.");
  const embedURL = convertToEmbed(yt);
  await db.collection("videos").add({
    title: title,
    url: embedURL,
    ts: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("videoTitle").value="";
  document.getElementById("youtubeURL").value="";
  loadVideos();
});

// ----------- LOAD VIDEOS -----------
async function loadVideos(){
  const container = document.getElementById("videosContainer");
  container.innerHTML="";
  const snap = await db.collection("videos").orderBy("ts","desc").get();
  snap.forEach(doc=>{
    const data = doc.data();
    const card = document.createElement("div");
    card.className="video-card";
    card.innerHTML = `<div class="title">${data.title}</div><iframe src="${data.url}" allowfullscreen></iframe>`;
    if(isAdmin){
      const del = document.createElement("button");
      del.className="delete-btn";
      del.textContent="Delete";
      del.onclick = async ()=>{
        if(!confirm("Delete this video?")) return;
        await db.collection("videos").doc(doc.id).delete();
        loadVideos();
      };
      card.appendChild(del);
    }
    container.appendChild(card);
  });
}

window.addEventListener("load", loadVideos);
</script>

</body>
</html>
